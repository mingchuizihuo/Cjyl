<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="com.idea.cjyl.totalmodule.web.dao.myself.OlderMapperMyself">

    <resultMap id="OlderBriefVO" type="com.idea.cjyl.totalmodule.web.domain.vo.OlderBriefVO">


        <id column="id" property="id" jdbcType="BIGINT"/>
        <result column="name" property="name" jdbcType="VARCHAR"/>
        <result column="check_in_date" property="checkInDate" jdbcType="VARCHAR"/>


        <result column="nation" property="nation" jdbcType="BIGITN"/>


        <result column="birthday" property="birthday" jdbcType="VARCHAR"/>
        <result column="take_care_of_oneself" property="takeCareOfOneself" jdbcType="BIGINT"/>
        <result column="card_id" property="cardId" jdbcType="VARCHAR"/>
        <result column="older_state" property="olderState" jdbcType="TINYINT"/>

        <result column="older_leave_date" property="olderLeaveDate" jdbcType="VARCHAR"/>
        <association property="staff" resultMap="StaffOlder" />
        <association property="mansion" resultMap="MansionOlder" />
        <association property="room" resultMap="RoomOlder" />
        <association property="bed" resultMap="BedOlder" />
        <association property="monthCharge" resultMap="MonthChargeOlder"></association>
        <collection property="checkInInitCostList" resultMap="CheckInInitCostOlder"></collection>
    </resultMap>

    <!--床位信息-->
    <resultMap id="BedOlder" type="com.idea.cjyl.totalmodule.web.domain.pojo.Bed" >
        <id column="id" property="id" jdbcType="BIGINT" />
        <result column="organization_login_id" property="organizationLoginId" jdbcType="BIGINT" />
        <result column="room_id" property="roomId" jdbcType="BIGINT" />
        <result column="bed_num" property="bedNum" jdbcType="TINYINT" />
        <result column="bed_state" property="bedState" jdbcType="TINYINT" />
        <result column="old_id" property="oldId" jdbcType="BIGINT" />
    </resultMap>
    <!--房间信息-->
    <resultMap id="RoomOlder" type="com.idea.cjyl.totalmodule.web.domain.pojo.Room" >
        <id column="id" property="id" jdbcType="BIGINT" />
        <result column="organization_login_id" property="organizationLoginId" jdbcType="BIGINT" />
        <result column="floor_tier_id" property="floorTierId" jdbcType="BIGINT" />
        <result column="room_num" property="roomNum" jdbcType="VARCHAR" />
        <result column="room_type" property="roomType" jdbcType="TINYINT" />
    </resultMap>
    <!--大厦信息-->
    <resultMap id="MansionOlder" type="com.idea.cjyl.totalmodule.web.domain.pojo.Mansion" >
        <id column="id" property="id" jdbcType="BIGINT" />
        <result column="organization_login_id" property="organizationLoginId" jdbcType="BIGINT" />
        <result column="name" property="name" jdbcType="VARCHAR" />
        <result column="account_for" property="accountFor" jdbcType="VARCHAR" />
    </resultMap>
    <!--员工对象-->
    <resultMap id="StaffVOOlder" type="com.idea.cjyl.totalmodule.web.domain.vo.StaffVO" >
        <id column="id" property="id" jdbcType="BIGINT" />
        <result column="organization_login_id" property="organizationLoginId" jdbcType="BIGINT" />
        <result column="name" property="name" jdbcType="VARCHAR" />
        <result column="card_id" property="cardId" jdbcType="VARCHAR" />
        <result column="sex" property="sex" jdbcType="BIGINT" />
        <result column="birthday" property="birthday" jdbcType="TIMESTAMP" />
        <result column="entry_date" property="entryDate" jdbcType="TIMESTAMP" />
        <result column="branch" property="branch" jdbcType="BIGINT" />
        <result column="duty" property="duty" jdbcType="BIGINT" />
        <result column="health_state" property="healthState" jdbcType="BIGINT" />
        <result column="tel" property="tel" jdbcType="VARCHAR" />
        <result column="marriage" property="marriage" jdbcType="BIGINT" />
        <result column="education" property="education" jdbcType="BIGINT" />
        <result column="major" property="major" jdbcType="BIGINT" />
        <result column="salary" property="salary" jdbcType="INTEGER" />
    </resultMap>
    <!--月消费-->
    <resultMap id="MonthChargeOlder" type="com.idea.cjyl.totalmodule.web.domain.pojo.MonthCharge">
        <id column="id" property="id" jdbcType="BIGINT"/>
        <result column="organization_login_id" property="organizationLoginId" jdbcType="BIGINT"/>
        <result column="nursing_grades" property="nursingGrades" jdbcType="VARCHAR"/>
        <result column="administrative_fee" property="administrativeFee" jdbcType="INTEGER"/>
        <result column="service_charge" property="serviceCharge" jdbcType="INTEGER"/>
        <result column="bed_cost" property="bedCost" jdbcType="INTEGER"/>
        <result column="food_cost" property="foodCost" jdbcType="INTEGER"/>
        <result column="total" property="total" jdbcType="INTEGER"/>
    </resultMap>
    <!--入院初始费用-->
    <resultMap id="CheckInInitCostOlder" type="com.idea.cjyl.totalmodule.web.domain.pojo.CheckInInitCost" >
        <id column="id" property="id" jdbcType="BIGINT" />
        <result column="organization_login_id" property="organizationLoginId" jdbcType="BIGINT" />
        <result column="item" property="item" jdbcType="VARCHAR" />
        <result column="is_refund" property="isRefund" jdbcType="TINYINT" />
        <result column="money" property="money" jdbcType="INTEGER" />
        <result column="account_for" property="accountFor" jdbcType="VARCHAR" />
    </resultMap>
    <sql id="Base_Column_List">
        older.id, older.name, date_format(older.check_in_date,'%Y年%m月%d日') check_in_date,
        older.nation, date_format(older.birthday,'%Y年%m月%d日') birthday, older.take_care_of_oneself,
        older.card_id, older.older_state, date_format(older.older_leave_date,'%Y年%m月%d日') older_leave_date,
        bed.id, bed.organization_login_id, bed.room_id, bed.bed_num, bed.bed_state, bed.old_id,
        staff.id, staff.organization_login_id, staff.name, staff.card_id, staff.sex, staff.birthday, staff.entry_date, staff.branch, staff.duty,
        staff.health_state, staff.tel, staff.marriage, staff.education, staff.major, staff.salary,
        mansion.id,  mansion.organization_login_id,  mansion.name,  mansion.account_for,
        room.id, room.organization_login_id, room.floor_tier_id, room.room_num, room.room_type,
        month_charge.id, month_charge.organization_login_id, month_charge.nursing_grades, month_charge.administrative_fee,
        month_charge.service_charge, month_charge.bed_cost,
        month_charge.food_cost, month_charge.total,

        ciic.id, ciic.organization_login_id, ciic.item, ciic.is_refund, ciic.money, ciic.account_for
    </sql>
    <select id="findAllVO" resultMap="BaseResultMap" parameterType="java.lang.Long">

        SELECT
        <include refid="Base_Column_List"></include>

        FROM older older
        LEFT JOIN staff staff JOIN ON older.staff_id = staff.id
        LEFT JOIN month_charge month_charge JOIN ON older.month_charge_id = month_charge.id
        LEFT JOIN older_initial_fee  JOIN ON older.id = older_initial_fee.old_id
        LEFT JOIN check_in_init_cost JOIN ON check_in_init_cost.id = older_initial_fee.check_in_init_cost_id

        LEFT JOIN bed bed JOIN ON bed.old_id = older.id
        LEFT JOIN room room JOIN ON room.id = bed.room_id
        LEFT JOIN floor_tier JOIN ON floor_tier.id = room.floor_tier_id
        LEFT JOIN mansion mansion JOIN mansion.id = floor_tier.mansion_id


    </select>


    <sql id="Example_Where_Clause">
        <where>
            <foreach collection="oredCriteria" item="criteria" separator="or">
                <if test="criteria.valid">
                    <trim prefix="(" suffix=")" prefixOverrides="and">
                        <foreach collection="criteria.criteria" item="criterion">
                            <choose>
                                <when test="criterion.noValue">
                                    and ${criterion.condition}
                                </when>
                                <when test="criterion.singleValue">
                                    and ${criterion.condition} #{criterion.value}
                                </when>
                                <when test="criterion.betweenValue">
                                    and ${criterion.condition} #{criterion.value} and #{criterion.secondValue}
                                </when>
                                <when test="criterion.listValue">
                                    and ${criterion.condition}
                                    <foreach collection="criterion.value" item="listItem" open="(" close=")"
                                             separator=",">
                                        #{listItem}
                                    </foreach>
                                </when>
                            </choose>
                        </foreach>
                    </trim>
                </if>
            </foreach>
        </where>
    </sql>




    <select id="findVOByExaple" resultMap="BaseResultMap"
            parameterType="com.idea.cjyl.totalmodule.web.domain.pojo.OlderExample">


        select
        <if test="distinct">
            distinct
        </if>
        <include refid="Base_Column_List"/>
        from older LEFT JOIN month_charge monthcharge ON older.month_charge_id = monthcharge.id
        <if test="_parameter != null">
            <include refid="Example_Where_Clause"/>
        </if>
        <if test="orderByClause != null">
            order by ${orderByClause}
        </if>
    </select>
</mapper>